# 从pytube迁移到yt-dlp指南

## 迁移背景

我们决定将YouTube批量下载工具从pytube库迁移到yt-dlp库，主要原因如下：

1. **稳定性问题**：pytube库经常受到YouTube API变更的影响，导致HTTP Error 400等错误频繁发生
2. **功能限制**：pytube在处理某些特殊格式或受限视频时存在局限性
3. **维护状态**：yt-dlp库拥有更活跃的社区支持和更频繁的更新
4. **错误处理**：yt-dlp提供更强大的错误处理和自动重试机制

## yt-dlp的优势

- **更稳定的下载体验**：不易受YouTube API变更影响
- **更全面的格式支持**：支持几乎所有YouTube提供的视频格式
- **更好的错误处理**：提供详细的错误信息和自动恢复机制
- **更多的下载选项**：支持更多自定义下载参数
- **更好的代理支持**：内置代理支持，无需额外配置
- **活跃的维护**：频繁更新以适应YouTube的变化

## 迁移变更

本次迁移主要涉及以下变更：

1. **依赖变更**：requirements.txt中的pytube替换为yt-dlp
2. **下载器实现**：新增ytdlp_downloader.py替代原有的downloader.py
3. **启动脚本更新**：run.py和offline_install.py中的依赖检查更新
4. **主程序更新**：main.py中使用新的下载器

## 使用方法

使用方法与之前基本相同，只需运行：

```
python run.py
```

程序会自动检查并安装yt-dlp依赖。

## 常见问题

### Q: 迁移后需要重新安装什么？

A: 只需运行run.py，它会自动检查并安装yt-dlp。如果您想手动安装，可以运行：
```
pip install yt-dlp
```

### Q: 迁移后界面有什么变化？

A: 用户界面保持不变，但下载体验会更加稳定，出错率更低。

### Q: 之前下载的视频会受影响吗？

A: 不会，迁移只影响下载功能的实现，不会影响已下载的视频文件。

### Q: 为什么选择yt-dlp而不是其他库？

A: yt-dlp是youtube-dl的一个分支，专注于修复原项目中的问题并添加新功能。它拥有活跃的社区支持和频繁的更新，是目前最可靠的YouTube下载解决方案之一。

## 注意事项

- 如果您之前使用了自定义的pytube相关脚本或修改，这些可能需要重新适配
- 某些高级功能的使用方式可能略有不同
- 首次使用新版本时，建议清空下载队列重新添加